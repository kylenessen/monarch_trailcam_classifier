---
title: Monarch Butterfly Image Classification Guide
author: Kyle Nessen
date: "February 15, 2025"
theme: theme.scss
format:
    html:
        toc: true
        embed-resources: true
---

## Overview

This guide explains how to use the Monarch Image Labeler tool to count butterflies in gridded photographs. The tool helps estimate butterfly populations consistently across multiple observers, focusing on efficiency and accuracy.

## Image Context

This project uses modified trail cameras designed for long-term outdoor deployment. These cameras are equipped with infrared filters that block visible light while allowing near-infrared light to pass through. This modification creates a stark contrast between living leaves (which appear bright) and butterflies (which appear dark), making butterfly identification easier. Due to this modification, images may sometimes appear purple (caused by white balance issues) or be converted to black and white by the camera.

![Modified trail camera and wind meter observing small cluster of monarch butterflies](resources/camera.jpg){width="400" fig-align="center"}

Here is a short video to show what I mean. Notice that the eucalyptus leaves are bright, almost glowing, while the butterflies are much darker in comparison.

![](resources/cluster.gif){fig-align="center"}

And here is another video showing even more butterflies, but in black and white:

![](resources/clusters2.gif){fig-align="center"}

## Getting Started

### Shared OneDrive folder

I should have shared a OneDrive link with your Cal Poly email called "Deployments." You can find the link below. If you have trouble accessing this link, please let me know.

::: text-center
<a href="https://cpslo-my.sharepoint.com/:f:/g/personal/knessen_calpoly_edu/ErvonPRpFOtBjDGUXYD6oN8BpxXiRz819CKByxWuEEOVVA?e=mVxlbQ" class="btn btn-primary">Deployments</a>
:::

Everything you need to get started is in this folder, including the Monarch Image Labeler software, and all the images that need to be analyzed. 

::: {.callout-important}
Please note that there are two versions of the software available. I have labeled them with your name, so make sure to download and use the version I specified for you. If you're unsure which version to use, please contact me.
:::

### What is a "deployment?"

Images are organized into sets called "deployments." A deployment represents data from a single camera, positioned at a specific location and direction, over a defined time period. Each deployment has a unique identifier (e.g., "SC4"). The identifier's prefix indicates the location - most are from Spring Canyon (SC), with some from Space Launch Complex 6 (SLC6) and UDMH. Deployments are numbered sequentially starting from the first setup at each location. You will typically be assigned one deployment to analyze using the software.

### Syncing images with OneDrive

For reliable access to the images, we'll use OneDrive's desktop sync feature:

1. **Install OneDrive Desktop**
    - [Download OneDrive](https://www.microsoft.com/en-us/microsoft-365/onedrive/download) if not already installed
    - Sign in with your Cal Poly credentials when prompted

2. **Set Up Sync**
    - Open OneDrive settings (click the cloud icon in your taskbar)
    - Choose "Settings" > "Account" > "Add a folder"
    - Navigate to the shared "Deployments" folder
    - Select it for syncing

3. **Locate Your Files**
    - On Mac: Look under "OneDrive - Cal Poly" or "OneDrive - Shared Libraries - Cal Poly"
    - On Windows: Check "OneDrive - California Polytechnic State University"
    - The deployment folders should appear in your local file system

::: {.callout-tip}
Make sure you have enough free disk space before syncing. Each deployment can contain several gigabytes of images.
:::

::: {.callout-warning}
If you can't find the synchronized files on your computer (NOT in browser), please contact me. The software requires local file access to function properly.
:::

### Managing storage

Since deployments can be quite large, you can manage your local storage efficiently using OneDrive's built-in features:

- **For your current deployment:**
    - Right-click the deployment folder
    - Select "Always keep on this device" to ensure constant access

![](resources/always_keep.png){width="300" fig-align="center"}

- **For completed deployments:**
    - Right-click the folder
    - Choose "Free up space" to remove local copies
    - Files remain accessible in OneDrive but won't take up local storage

![](resources/free_up_space.png){width="300" fig-align="center"}

::: {.callout-tip}
Only keep the deployment you're currently working on downloaded locally. This helps manage disk space while ensuring you have quick access to the files you need.
:::



### Installation

## Basic Controls

-   Use `S` or `→`to go to next photo
-   Use `A` or `←` to go to previous photo
-   Use `Space` to zoom in 300% for detailed inspection
-   Press `W` or click "Confirm Image" to save and proceed
-   Press `S` to copy classifications from previous image
-   Use `N` to toggle notes for unusual circumstances
-   "Switch to Color" button toggles between B&W and color views
-   Keyboard shortcuts can be referenced anytime from the button in the top right.

## Count Categories

Each image is divided into a grid cells, and our job is to categorize each cell by the count category. These follow orders of magnitude, so there can be zero butterflies (empty cell), a few butterflies (1-9), tens of butterflies (10-99), hundreds (100-999) or thousands (1000+). The software is designed to easily be able to label each grid cell with a few clicks. Each category corresponds to a certain color (see points below) so you can easily tell what you have already labeled.

-   0 (Default): No butterflies (No color)
-   1-9: Single digits (Yellow)
-   10-99: Dozens (Orange)
-   100-999: Hundreds (Red)
-   1000+: Thousands (Purple)

Below I'll go through each category and how to determine when to apply them. 

### (0) No Butterflies

By default, all cells start with this category, and it has no associated symbology (e.g., an empty cell). The vast majority of cells will fall into this category, with many photos being entirely composed of empty cells. The cell should be completely free of butterflies to have this label. If a butterfly is partially within the grid, upgrade the category to the next appropriate level, likely 1-9. 

You can always select the 0 category to "remove" a color on the screen. Additionally, you can hold command + right click (two fingers on a Mac trackpad) to reclassify a grid cell as zero while selecting any category. Useful for deleting or cleaning up your categories. 

While there are many ways a zero category can look here is a selection of a few. All grid cells fall into the zero category.

|                                               |                                               |
| --------------------------------------------- | --------------------------------------------- |
| ![](resources/zeros/zero_1.png){width="100%"} | ![](resources/zeros/zero_2.png){width="100%"} |
| ![](resources/zeros/zero_3.png){width="100%"} | ![](resources/zeros/zero_4.png){width="100%"} |
| ![](resources/zeros/zero_5.png){width="100%"} | ![](resources/zeros/zero_6.png){width="100%"} |

### (1-9) Single Butterflies

This category should be used when you can clearly count all butterflies within the grid cell and there are less than 10 present. Partial butterflies should be included in this count, and can be included in the count for both partial cells. If this "double counting" happens to upgrade the neighboring cell to a higher category, then use your best judgement to accurately and conservatively estimate the scene. 

It does not matter if the butterflies are at rest or in flight, if they are in the cell, they should be counted.

I generally do this category last as a final clean up of the larger clusters. 

Here are some example images:

|                                                    |                                                    |
| -------------------------------------------------- | -------------------------------------------------- |
| ![](resources/singles/singles_1.png){width="100%"} | ![](resources/singles/singles_2.png){width="50%"} |
| ![](resources/singles/singles_3.png){width="100%"} | ![](resources/singles/singles_4.png){width="100%"} |

## Classification Process

### 1. Initial Assessment

1.  Begin with the most densely populated cells
2.  Use Space-bar zoom (300%) to inspect unclear areas
3.  All cells start as 0 (uncolored) by default

### 2. Dense Cluster Protocol

For cells with large clusters:

-   If butterflies clearly exceed 100, classify as hundreds (red)
-   For dense clusters where butterflies may be obscured, apply a 1.3X multiplier
-   Example: If you can count \~80 butterflies in a dense cluster, multiply by 1.3 = 104, classify as hundreds
-   Only apply this multiplier when butterflies are likely obscured in dense clusters

\[INSERT: Animation/images showing dense cluster assessment\]

### 3. Medium Density Areas

-   If more than a few butterflies but not obviously hundreds, classify as dozens (orange)
-   No need to get exact counts - if you can quickly count \<10, it's yellow; if it takes longer, it's likely orange

### 4. Scanning for Singles

-   After marking dense areas, scan for isolated butterflies or small groups
-   Include both flying and roosting butterflies
-   For 1-9 butterflies, mark as yellow

### 5. Border Cases

When clusters cross grid lines: - Only count butterflies within the current cell - Round up when in doubt - Some double-counting at borders is acceptable given the coarse estimation scale

\[INSERT: Example of border case handling\]

### 6. Sunlight Labeling

-   For cells containing butterflies, note if they are in full sun
-   Only label sun exposure for cells that contain butterflies
-   Use F + Click to toggle sunlight for a cell

## Best Practices

### Speed vs. Accuracy

-   Prioritize efficiency over precise counts
-   When uncertain between categories, round up
-   The goal is order-of-magnitude estimation
-   Don't spend excessive time on exact counts

### Required Steps Before Moving On

4.  Ensure username is entered
5.  Complete all cell classifications
6.  Mark sunlight exposure where applicable
7.  Add notes if necessary (blue button indicates notes present)
8.  Confirm image to save and proceed

\[INSERT: Screenshot of completed image with various classifications\]

## Common Scenarios and Solutions

